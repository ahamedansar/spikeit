<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPIKEIT Authentication</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons (for icons) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">

    <style>
        /* General Styling for all views */
        body {
            background-color: #f3f4f6; /* Light gray background */
            font-family: 'Inter', sans-serif;
            margin: 0;
        }
        .app-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        /* Styling for the central login card */
        .auth-card {
            max-width: 400px;
            width: 100%;
            padding: 2rem;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* shadow-2xl */
            background-color: white;
            border: 1px solid #e5e7eb; /* border-gray-100 */
            position: relative; 
        }
        /* Custom Primary Button */
        .btn-primary-custom {
            background-color: #4f46e5; /* indigo-600 */
            border-color: #4f46e5;
            font-weight: 600;
            transition: background-color 0.15s;
        }
        .btn-primary-custom:hover {
            background-color: #4338ca; /* indigo-700 */
            border-color: #4338ca;
        }
        .input-group-text {
            background-color: #fff;
            border-left: 0;
        }
        .form-control:focus {
            box-shadow: 0 0 0 0.25rem rgba(79, 70, 229, 0.25); /* focus:ring-indigo-500 */
            border-color: #4f46e5;
        }
        /* Home View Specific */
        #home-view .welcome-card {
            max-width: 500px;
            padding: 3rem;
        }
        /* Updated Back Button Styling for better visibility */
        .back-to-home-btn {
            position: absolute;
            top: 20px; /* Slightly lower */
            left: 20px; /* Slightly more inside */
            color: #1f2937; /* Darker color */
            padding: 0.5rem;
            background-color: transparent;
            border: none;
            z-index: 10;
        }
        .back-to-home-btn:hover {
            color: #4f46e5; /* Primary color on hover */
        }
        
    </style>
</head>
<body>

    <div class="app-container">

        <!-- Back Button (Now visible on all auth pages, takes user to index.html) -->
        <button id="back-to-home" class="btn back-to-home-btn" style="display: none;" title="Go to Main App">
            <i class="bi bi-arrow-left fs-4"></i>
        </button>
        
        <!-- ======================================================= -->
        <!-- 1. LOGIN VIEW (Default) -->
        <!-- ======================================================= -->
        <div id="login-view" class="auth-card">
            <div class="text-center mb-4">
                <span class="fs-2 fw-bold text-primary-custom" style="color: #4f46e5;">
                    <a href="#" class="text-decoration-none logo-link" style="color: inherit;"> SPIKEIT </a>
                </span>
            </div>
            <h2 class="fs-4 fw-bold mb-1">Sign In</h2>
            <p class="text-secondary mb-4">Welcome back to SPIKEIT!</p>

            <form id="login-form">
                <div class="input-group mb-3">
                    <span class="input-group-text"><i class="bi bi-envelope text-secondary"></i></span>
                    <input type="email" id="login-email" class="form-control" placeholder="Email Address" required>
                </div>
                
                <div class="input-group mb-4">
                    <span class="input-group-text"><i class="bi bi-lock text-secondary"></i></span>
                    <input type="password" id="login-password" class="form-control" placeholder="Password" required>
                </div>

                <div class="d-flex justify-content-end mb-4">
                    <button type="button" id="forgot-password-link" class="btn btn-link p-0 text-decoration-none" style="color: #4f46e5;">Forgot Password?</button>
                </div>

                <button type="submit" class="btn btn-primary-custom w-100 py-3 mb-3">
                    Sign In
                </button>
            </form>

            <div class="text-center mt-3 small">
                Don't have an account? 
                <button type="button" id="show-signup" class="btn btn-link p-0 text-decoration-none fw-bold" style="color: #4f46e5;">Sign Up</button>
            </div>
        </div>

        <!-- ======================================================= -->
        <!-- 2. SIGNUP VIEW (Hidden by default) -->
        <!-- ======================================================= -->
        <div id="signup-view" class="auth-card" style="display: none;">
            <div class="text-center mb-4">
                <span class="fs-2 fw-bold text-primary-custom" style="color: #4f46e5;">
                    <a href="#" class="text-decoration-none logo-link" style="color: inherit;"> SPIKEIT </a>
                </span>
            </div>
            <h2 class="fs-4 fw-bold mb-1">Create Account</h2>
            <p class="text-secondary mb-4">Join the fitness community.</p>

            <form id="signup-form">
                <div class="input-group mb-3">
                    <span class="input-group-text"><i class="bi bi-person text-secondary"></i></span>
                    <input type="text" id="signup-name" class="form-control" placeholder="Full Name" required>
                </div>
                
                <div class="input-group mb-3">
                    <span class="input-group-text"><i class="bi bi-envelope text-secondary"></i></span>
                    <input type="email" id="signup-email" class="form-control" placeholder="Email Address" required>
                </div>
                
                <div class="input-group mb-4">
                    <span class="input-group-text"><i class="bi bi-lock text-secondary"></i></span>
                    <input type="password" id="signup-password" class="form-control" placeholder="Password" required>
                </div>

                <button type="submit" class="btn btn-primary-custom w-100 py-3 mb-3">
                    Sign Up
                </button>
            </form>

            <div class="text-center mt-3 small">
                Already have an account? 
                <button type="button" id="show-login" class="btn btn-link p-0 text-decoration-none fw-bold" style="color: #4f46e5;">Sign In</button>
            </div>
        </div>

        <!-- ======================================================= -->
        <!-- 3. OTP VERIFICATION VIEW (Hidden by default) -->
        <!-- ======================================================= -->
        <div id="otp-view" class="auth-card" style="display: none;">
            <div class="text-center mb-4">
                <span class="fs-2 fw-bold text-primary-custom" style="color: #4f46e5;">
                    <a href="#" class="text-decoration-none logo-link" style="color: inherit;"> SPIKEIT </a>
                </span>
            </div>
            <h2 class="fs-4 fw-bold mb-1">Enter Verification Code</h2>
            <p class="text-secondary mb-4 small">
                Sent to <span class="fw-semibold" id="otp-email-display"></span>. (Mock Code: 123456)
            </p>

            <form id="otp-form">
                <div class="mb-4">
                    <input type="text" id="otp-input" class="form-control form-control-lg text-center tracking-wider" 
                           placeholder="6-digit code" 
                           maxlength="6"
                           required>
                </div>

                <div id="otp-error" class="text-danger text-sm mb-3" style="display: none;"></div>

                <button type="submit" id="otp-submit-btn" class="btn btn-primary-custom w-100 py-3 mb-3">
                    Verify & Log In
                </button>
            </form>

            <div class="text-center mt-3 small">
                <div id="resend-timer-display" class="text-secondary mb-2"></div>
                <button type="button" id="resend-otp-btn" class="btn btn-link p-0 text-decoration-none fw-bold" style="color: #4f46e5;">
                    Resend Code
                </button>
            </div>
        </div>

        <!-- ======================================================= -->
        <!-- 4. FORGOT PASSWORD VIEW (Hidden by default) -->
        <!-- ======================================================= -->
        <div id="forgot-view" class="auth-card" style="display: none;">
            <div class="text-center mb-4">
                <span class="fs-2 fw-bold text-primary-custom" style="color: #4f46e5;">
                    <a href="#" class="text-decoration-none logo-link" style="color: inherit;"> SPIKEIT </a>
                </span>
            </div>
            <h2 class="fs-4 fw-bold mb-1">Forgot Password?</h2>
            <p class="text-secondary mb-4">Enter your email to receive a verification code.</p>

            <form id="forgot-form">
                <div class="input-group mb-4">
                    <span class="input-group-text"><i class="bi bi-envelope text-secondary"></i></span>
                    <input type="email" id="forgot-email" class="form-control" placeholder="Email Address" required>
                </div>

                <div id="forgot-message" class="text-success text-sm mb-3" style="display: none;"></div>

                <button type="submit" class="btn btn-warning w-100 py-3 mb-3">
                    Send Code
                </button>
            </form>

            <div class="text-center mt-3 small">
                <button type="button" id="forgot-back-to-login" class="btn btn-link p-0 text-decoration-none fw-bold" style="color: #4f46e5;">Back to Sign In</button>
            </div>
        </div>
        
        <!-- ======================================================= -->
        <!-- 5. RESET PASSWORD VIEW (NEW) -->
        <!-- ======================================================= -->
        <div id="reset-view" class="auth-card" style="display: none;">
            <div class="text-center mb-4">
                <span class="fs-2 fw-bold text-primary-custom" style="color: #4f46e5;">
                    <a href="#" class="text-decoration-none logo-link" style="color: inherit;"> SPIKEIT </a>
                </span>
            </div>
            <h2 class="fs-4 fw-bold mb-1">Set New Password</h2>
            <p class="text-secondary mb-4">Your code was verified. Set a new password.</p>

            <form id="reset-form">
                <div class="input-group mb-3">
                    <span class="input-group-text"><i class="bi bi-key text-secondary"></i></span>
                    <input type="password" id="reset-password" class="form-control" placeholder="New Password" required>
                </div>
                
                <div class="input-group mb-4">
                    <span class="input-group-text"><i class="bi bi-key text-secondary"></i></span>
                    <input type="password" id="confirm-password" class="form-control" placeholder="Confirm New Password" required>
                </div>
                
                <div id="reset-error" class="text-danger text-sm mb-3" style="display: none;"></div>


                <button type="submit" class="btn btn-primary-custom w-100 py-3 mb-3">
                    Reset Password & Log In
                </button>
            </form>

            <div class="text-center mt-3 small">
                <button type="button" id="reset-back-to-login" class="btn btn-link p-0 text-decoration-none fw-bold" style="color: #4f46e5;">Back to Sign In</button>
            </div>
        </div>

        <!-- ======================================================= -->
        <!-- 6. HOME PAGE VIEW (Hidden by default) -->
        <!-- ======================================================= -->
        <div id="home-view" class="auth-card welcome-card" style="display: none;">
            <div class="text-center">
                <i class="bi bi-check-circle-fill fs-1 text-success mb-3"></i>
                <h1 class="fs-3 fw-bold mb-2">Welcome Back!</h1>
                <p class="text-secondary mb-4">
                    Email login successful for: <br/>
                    <span class="font-monospace text-primary fw-semibold" id="home-email-display"></span>
                </p>
                
                <p class="text-sm text-muted mb-5">
                    This is your simulated home page. You are now logged in.
                </p>

                <div class="d-grid gap-3">
                    <button type="button" id="logout-btn" class="btn btn-danger py-3">
                        Log Out
                    </button>
                    <!-- This button simulates navigating to a different page post-login -->
                    <a href="index.html" class="btn btn-outline-primary py-3">
                        Go to Shop Collections
                    </a>
                </div>
            </div>
        </div>

    </div>

    <!-- jQuery and Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // --- GLOBAL STATE & CONSTANTS ---
        const VIEWS = ['#login-view', '#signup-view', '#otp-view', '#forgot-view', '#reset-view', '#home-view'];
        const MOCK_OTP = '123456';
        const RESEND_TIMER_SECONDS = 30;
        let timerInterval;
        let currentEmail = '';
        let otpOrigin = 'login'; 

        // --- VIEW SWITCHING LOGIC ---
        function showView(viewId, origin = null) {
            VIEWS.forEach(id => {
                $(id).hide();
            });
            $(viewId).fadeIn(300);
            
            if (origin) {
                otpOrigin = origin;
            }

            // --- REVISED BACK BUTTON LOGIC ---
            // Show back button on all authentication forms (Login, Signup, Forgot, OTP, Reset) 
            // to allow navigation to index.html. Hide it only on the final success/home view.
            if (viewId === '#home-view') {
                $('#back-to-home').hide();
            } else {
                $('#back-to-home').show();
            }
            
            // Dynamic text for OTP submit button
            if (viewId === '#otp-view') {
                if (otpOrigin === 'forgot') {
                    $('#otp-submit-btn').text('Verify Code');
                } else {
                    $('#otp-submit-btn').text('Verify & Log In');
                }
            }

            // Clear any lingering errors/messages
            $('#otp-error').hide().text('');
            $('#forgot-message').hide().text('');
            $('#reset-error').hide().text('');
            clearInterval(timerInterval); 
        }

        // --- RESEND TIMER LOGIC ---
        function startTimer() {
            let timer = RESEND_TIMER_SECONDS;
            $('#resend-otp-btn').prop('disabled', true).text('Wait for resend');
            $('#resend-timer-display').text(`Resend in 0:${timer.toString().padStart(2, '0')}`).show();

            timerInterval = setInterval(() => {
                timer--;
                $('#resend-timer-display').text(`Resend in 0:${timer.toString().padStart(2, '0')}`);
                if (timer <= 0) {
                    clearInterval(timerInterval);
                    $('#resend-timer-display').hide();
                    $('#resend-otp-btn').prop('disabled', false).text('Resend Code');
                }
            }, 1000);
        }

        // --- EVENT HANDLERS (Document Ready) ---
        $(document).ready(function() {

            // --- NAVIGATION ---
            $('#show-signup').on('click', () => showView('#signup-view', 'signup'));
            
            // Internal Navigation: Links at the bottom of forms go back to Login view
            $('#show-login, #forgot-back-to-login, #reset-back-to-login').on('click', () => showView('#login-view', 'login'));
            
            $('#forgot-password-link').on('click', () => showView('#forgot-view'));
            
            // *** EXTERNAL BACK BUTTON LOGIC: NAVIGATES TO index.html ***
            $('#back-to-home').on('click', function() {
                // Exit the entire authentication flow and go to the application's index page
                window.location.href = 'index.html'; 
            });
            
            // --- Logo Navigation Handler: Uses JS to handle internal view switch ---
            $('.logo-link').on('click', function(e) {
                e.preventDefault(); 
                showView('#login-view');
            });


            // --- FORM SUBMISSIONS (Login/Signup/Forgot -> OTP) ---
            
            // 1. LOGIN
            $('#login-form').on('submit', function(e) {
                e.preventDefault();
                currentEmail = $('#login-email').val();
                $('#otp-email-display').text(currentEmail);
                showView('#otp-view', 'login'); // Set origin to 'login'
                startTimer();
            });

            // 2. SIGNUP
            $('#signup-form').on('submit', function(e) {
                e.preventDefault();
                currentEmail = $('#signup-email').val();
                $('#otp-email-display').text(currentEmail);
                showView('#otp-view', 'signup'); // Set origin to 'signup'
                startTimer();
            });

            // 3. FORGOT PASSWORD
            $('#forgot-form').on('submit', function(e) {
                e.preventDefault();
                currentEmail = $('#forgot-email').val();
                
                $('#forgot-message')
                    .text(`Verification code sent to ${currentEmail}!`)
                    .fadeIn(300);

                // Simulate server delay before redirect
                setTimeout(() => {
                    $('#otp-email-display').text(currentEmail);
                    showView('#otp-view', 'forgot'); // Set origin to 'forgot'
                    startTimer();
                }, 1500);
            });


            // --- OTP VERIFICATION ---
            $('#otp-form').on('submit', function(e) {
                e.preventDefault();
                const enteredOtp = $('#otp-input').val();
                
                $('#otp-error').hide();

                if (enteredOtp === MOCK_OTP) {
                    // Check the origin of the OTP request
                    if (otpOrigin === 'forgot') {
                        // Success from Forgot Password -> Go to Reset Password View
                        showView('#reset-view');
                    } else {
                        // Success from Login or Signup -> Go to Home View
                        $('#home-email-display').text(currentEmail);
                        showView('#home-view');
                    }
                } else {
                    $('#otp-error').text('Invalid OTP. Please check your code.').fadeIn(300);
                }
            });
            
            // --- RESET PASSWORD ---
            $('#reset-form').on('submit', function(e) {
                e.preventDefault();
                const newPassword = $('#reset-password').val();
                const confirmPassword = $('#confirm-password').val();
                
                $('#reset-error').hide();

                if (newPassword !== confirmPassword) {
                    $('#reset-error').text('Passwords do not match.').fadeIn(300);
                    return;
                }
                
                // MOCK SUCCESS: Simulate password reset and redirect to home
                $('#home-email-display').text(currentEmail);
                showView('#home-view');
            });


            // --- RESEND OTP ---
            $('#resend-otp-btn').on('click', function() {
                console.log(`New mock OTP (${MOCK_OTP}) resent to ${currentEmail}.`);
                startTimer();
            });


            // --- HOME PAGE / LOGOUT ---
            $('#logout-btn').on('click', function() {
                currentEmail = '';
                otpOrigin = 'login';
                showView('#login-view');
            });

            // Initialize by showing the first view and setting up back button visibility
            showView('#login-view');
        });
    </script>
</body>
</html>
