<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Checkout | Spike It Sports</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

  <style>
    body {
      background: linear-gradient(135deg, #f1f8f6, #ffffff);
      font-family: 'Poppins', sans-serif;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .checkout-card {
      background: #fff;
      border-radius: 15px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
      padding: 40px;
      max-width: 1000px;
      width: 100%;
    }
    .btn {
      border-radius: 25px;
      transition: all 0.3s ease;
    }
    .btn:hover { transform: translateY(-2px); }
    .list-group-item {
      border: none;
      border-bottom: 1px solid #eee;
    }
    .qr-img {
      width: 220px;
      height: 220px;
      border-radius: 12px;
      border: 2px solid #198754;
      display: block;
      margin: 0 auto;
    }
    .payment-option {
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 10px;
      cursor: pointer;
      transition: 0.3s;
    }
    .payment-option:hover {
      border-color: #198754;
      background: #f8fff9;
    }
    .payment-option input {
      margin-right: 10px;
    }
    .hidden { display: none; }
  </style>
</head>
<body>

  <div class="checkout-card">
    <div class="row g-4">
      
      <!-- üßæ Billing Details -->
      <div class="col-lg-7">
        <h4 class="fw-bold mb-3">Billing & Shipping Details</h4>
        <form id="checkoutForm" novalidate>
          <div class="mb-3">
            <label class="form-label fw-semibold">Full Name</label>
            <input type="text" id="name" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label fw-semibold">Email</label>
            <input type="email" id="email" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label fw-semibold">Address</label>
            <input type="text" id="address" class="form-control" required>
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label fw-semibold">City</label>
              <input type="text" id="city" class="form-control" required>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label fw-semibold">PIN Code</label>
              <input type="text" id="zip" class="form-control" pattern="[0-9]{6}" required>
            </div>
          </div>
        </form>
      </div>

      <!-- üí≥ Order Summary + Payment Options -->
      <div class="col-lg-5">
        <h4 class="fw-bold mb-3">Order Summary</h4>
        <div id="orderItems"></div>
        <hr>
        <h5 class="fw-semibold">Total: <span id="totalAmount" class="text-success">‚Çπ0</span></h5>
        
        <hr>
        <h5 class="fw-bold mb-3">Payment Options</h5>
        
        <div class="payment-option">
          <input type="radio" name="paymentMethod" id="upiOption" value="upi"> 
          <label for="upiOption"><i class="fa-brands fa-google-pay text-success me-2"></i>UPI / QR Code</label>
          <div id="upiInput" class="hidden mt-2">
            <input type="text" id="upi" class="form-control" placeholder="yourname@upi">
            <button class="btn btn-outline-success mt-2 w-100" data-bs-toggle="modal" data-bs-target="#qrModal">
              <i class="fa-solid fa-qrcode me-2"></i>View QR Code
            </button>
          </div>
        </div>

        <div class="payment-option">
          <input type="radio" name="paymentMethod" id="cardOption" value="card">
          <label for="cardOption"><i class="fa-regular fa-credit-card text-primary me-2"></i>Credit / Debit Card</label>
          <div id="cardInput" class="hidden mt-2">
            <input type="text" id="cardNumber" class="form-control mb-2" placeholder="Card Number (16 digits)">
            <div class="row">
              <div class="col-6"><input type="text" id="expiry" class="form-control mb-2" placeholder="MM/YY"></div>
              <div class="col-6"><input type="text" id="cvv" class="form-control mb-2" placeholder="CVV"></div>
            </div>
          </div>
        </div>

        <div class="payment-option">
          <input type="radio" name="paymentMethod" id="netOption" value="net">
          <label for="netOption"><i class="fa-solid fa-building-columns text-info me-2"></i>Net Banking</label>
          <div id="netInput" class="hidden mt-2">
            <select id="bankSelect" class="form-select">
              <option value="">Select Your Bank</option>
              <option>State Bank of India</option>
              <option>HDFC Bank</option>
              <option>ICICI Bank</option>
              <option>Axis Bank</option>
              <option>Kotak Mahindra Bank</option>
            </select>
          </div>
        </div>

        <div class="payment-option">
          <input type="radio" name="paymentMethod" id="codOption" value="cod">
          <label for="codOption"><i class="fa-solid fa-truck text-warning me-2"></i>Cash on Delivery (COD)</label>
        </div>

        <button id="payNowBtn" class="btn btn-success w-100 mt-3 py-2 fs-5">
          Proceed to Payment <i class="fa-solid fa-arrow-right ms-2"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- üßæ QR Code Modal -->
  <div class="modal fade" id="qrModal" tabindex="-1" aria-labelledby="qrModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content p-3">
        <div class="modal-header border-0">
          <h5 class="modal-title fw-bold" id="qrModalLabel">Scan to Pay</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body text-center">
          <img src="https://api.qrserver.com/v1/create-qr-code/?size=220x220&data=upi://pay?pa=yourname@upi&pn=Spike%20It%20Sports&cu=INR" 
               alt="UPI QR Code" class="qr-img mb-3">
          <p class="text-muted small">Scan using any UPI app (GPay, PhonePe, Paytm, etc.)</p>
        </div>
        <div class="modal-footer border-0 justify-content-center">
          <button type="button" class="btn btn-success px-4" data-bs-dismiss="modal">Payment Done</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚úÖ Script -->
  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const orderContainer = document.getElementById("orderItems");
    const totalAmountEl = document.getElementById("totalAmount");
    const payNowBtn = document.getElementById("payNowBtn");
    const cart = JSON.parse(localStorage.getItem("cart")) || [];

    let total = 0;

    // üõí Display Cart Summary
    if (cart.length === 0) {
      orderContainer.innerHTML = `
        <div class="alert alert-warning text-center">Your cart is empty.</div>
        <a href="index.html" class="btn btn-outline-dark w-100 mt-3">Back to Shop</a>
      `;
      payNowBtn.disabled = true;
      return;
    }

    let html = '<ul class="list-group mb-3">';
    cart.forEach(item => {
      const price = Number(item.price) || 0;
      const qty = Number(item.qty) || 1;
      const subtotal = price * qty;
      total += subtotal;
      html += `
        <li class="list-group-item d-flex justify-content-between align-items-center">
          <div><strong>${item.name}</strong><br><small>Qty: ${qty} √ó ‚Çπ${price}</small></div>
          <span>‚Çπ${subtotal}</span>
        </li>`;
    });
    html += '</ul>';
    orderContainer.innerHTML = html;
    totalAmountEl.textContent = `‚Çπ${total.toLocaleString()}`;

    // Toggle input visibility by method
    document.querySelectorAll('input[name="paymentMethod"]').forEach(option => {
      option.addEventListener('change', () => {
        document.querySelectorAll('#upiInput,#cardInput,#netInput').forEach(el => el.classList.add('hidden'));
        if (option.value === 'upi') document.getElementById('upiInput').classList.remove('hidden');
        if (option.value === 'card') document.getElementById('cardInput').classList.remove('hidden');
        if (option.value === 'net') document.getElementById('netInput').classList.remove('hidden');
      });
    });

    // üí≥ Proceed Payment
    payNowBtn.addEventListener("click", () => {
      const name = document.getElementById("name").value.trim();
      const email = document.getElementById("email").value.trim();
      const address = document.getElementById("address").value.trim();
      const city = document.getElementById("city").value.trim();
      const zip = document.getElementById("zip").value.trim();
      const selected = document.querySelector('input[name="paymentMethod"]:checked');

      if (!name || !email || !address || !city || !zip) {
        alert("‚ö†Ô∏è Please fill all required fields.");
        return;
      }
      if (!selected) {
        alert("‚ö†Ô∏è Please select a payment method.");
        return;
      }

      const method = selected.value;

      if (method === "upi") {
        const upi = document.getElementById("upi").value.trim();
        const upiPattern = /^[a-zA-Z0-9.\-_]{2,}@[a-zA-Z]{2,}$/;
        if (!upiPattern.test(upi)) {
          alert("‚ùå Payment Failed! Invalid UPI ID format.");
          window.location.href = "payment-failed.html";
          return;
        }
      }

      if (method === "card") {
        const card = document.getElementById("cardNumber").value.trim();
        const expiry = document.getElementById("expiry").value.trim();
        const cvv = document.getElementById("cvv").value.trim();
        if (!/^[0-9]{16}$/.test(card) || !/^[0-9]{2}\/[0-9]{2}$/.test(expiry) || !/^[0-9]{3}$/.test(cvv)) {
          alert("‚ùå Invalid card details!");
          window.location.href = "payment-failed.html";
          return;
        }
      }

      if (method === "net") {
        const bank = document.getElementById("bankSelect").value;
        if (!bank) {
          alert("‚ö†Ô∏è Please select your bank.");
          return;
        }
      }

      const orderId = "SPIKE" + Math.floor(Math.random() * 1000000);
      const orderSummary = { orderId, name, email, address, city, zip, total, method };
      localStorage.setItem("orderSummary", JSON.stringify(orderSummary));
      localStorage.removeItem("cart");

      alert(`‚úÖ Payment Successful!\nThank you ${name}! Your order ID: ${orderId}`);
      window.location.href = "payment-success.html";
    });
  });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
